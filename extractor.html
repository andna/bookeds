<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Content Extractor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        textarea {
            width: 100%;
            height: 400px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .success {
            background-color: #28a745;
        }
        h2 {
            color: #333;
            margin-bottom: 10px;
        }
        .section {
            display: flex;
            flex-direction: column;
        }
    </style>
</head>
<body>
    <h1>Draft.js Content Extractor</h1>
    <p>Paste your complex HTML content on the left, click "Extract", and get clean HTML on the right.</p>
    
    <div style="margin-bottom: 10px;">
        <button onclick="extractContent()">Extract Content</button>
        <button onclick="copyOutput()" class="success">Copy Output</button>
        <button onclick="loadFromPage()">Load from index.html</button>
    </div>
    
    <div class="container">
        <div class="section">
            <h2>Input (Complex HTML)</h2>
            <textarea id="input" placeholder="Paste your HTML here..."></textarea>
        </div>
        
        <div class="section">
            <h2>Output (Clean HTML)</h2>
            <textarea id="output" readonly></textarea>
        </div>
    </div>

    <script>
        function getBlockType(element) {
            const classList = element.classList;
            const tagName = element.tagName.toLowerCase();
            
            // Check for headers
            if (classList.contains('longform-header-two') || tagName === 'h2') {
                return { tag: 'h2' };
            }
            if (classList.contains('longform-header-three') || tagName === 'h3') {
                return { tag: 'h3' };
            }
            
            // Check for blockquote
            if (classList.contains('longform-blockquote') || tagName === 'blockquote') {
                return { tag: 'blockquote' };
            }
            
            // Check for lists
            if (classList.contains('longform-ordered-list-item')) {
                return { tag: 'li', listType: 'ol' };
            }
            if (classList.contains('longform-unordered-list-item')) {
                return { tag: 'li', listType: 'ul' };
            }
            
            // Check for section/separator
            if (tagName === 'section' || element.querySelector('[role="separator"]')) {
                return { tag: 'hr' };
            }
            
            // Default to paragraph
            if (classList.contains('longform-unstyled')) {
                return { tag: 'p' };
            }
            
            return { tag: 'div' };
        }

        function getTextContent(element) {
            let text = '';
            const walker = document.createTreeWalker(
                element,
                NodeFilter.SHOW_TEXT,
                null,
                false
            );
            
            while (walker.nextNode()) {
                text += walker.currentNode.textContent;
            }
            
            // Clean up extra whitespace
            text = text.replace(/\s+/g, ' ').trim();
            return text;
        }

        function processBlocks(container) {
            const blocks = container.querySelectorAll('[data-block="true"]');
            const result = [];
            let currentList = null;
            let currentListType = null;
            
            blocks.forEach(block => {
                const blockInfo = getBlockType(block);
                const content = getTextContent(block);
                
                if (!content.trim()) return;
                
                if (blockInfo.tag === 'li') {
                    // Handle list items
                    if (currentListType !== blockInfo.listType) {
                        if (currentList !== null) {
                            result.push(`</${currentListType}>`);
                        }
                        result.push(`<${blockInfo.listType}>`);
                        currentListType = blockInfo.listType;
                        currentList = [];
                    }
                    result.push(`  <li>${content}</li>`);
                } else {
                    // Close any open list
                    if (currentList !== null) {
                        result.push(`</${currentListType}>`);
                        currentList = null;
                        currentListType = null;
                    }
                    
                    if (blockInfo.tag === 'hr') {
                        result.push('<hr>');
                    } else {
                        result.push(`<${blockInfo.tag}>${content}</${blockInfo.tag}>`);
                    }
                }
            });
            
            // Close final list if open
            if (currentList !== null) {
                result.push(`</${currentListType}>`);
            }
            
            return result.join('\n');
        }

        function extractContent() {
            const input = document.getElementById('input').value;
            
            if (!input.trim()) {
                alert('Please paste some HTML content first!');
                return;
            }
            
            try {
                const parser = new DOMParser();
                const doc = parser.parseFromString(input, 'text/html');
                const container = doc.querySelector('[data-contents="true"]') || doc.body;
                
                const cleanHTML = processBlocks(container);
                document.getElementById('output').value = cleanHTML;
            } catch (error) {
                alert('Error parsing HTML: ' + error.message);
                console.error(error);
            }
        }

        function copyOutput() {
            const output = document.getElementById('output');
            output.select();
            document.execCommand('copy');
            
            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = 'Copied!';
            setTimeout(() => {
                btn.textContent = originalText;
            }, 2000);
        }

        function loadFromPage() {
            // Try to load content from index.html if it's accessible
            fetch('index.html')
                .then(response => response.text())
                .then(html => {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    const container = doc.querySelector('.container');
                    if (container) {
                        document.getElementById('input').value = container.innerHTML;
                        alert('Content loaded! Now click "Extract Content"');
                    } else {
                        alert('Could not find container in index.html');
                    }
                })
                .catch(error => {
                    alert('Could not load index.html. Please paste content manually.');
                    console.error(error);
                });
        }
    </script>
</body>
</html>
